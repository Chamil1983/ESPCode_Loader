<?xml version="1.0" encoding="utf-8"?>
<!--
  Web.config for ESP32 Arduino Web Loader
  Last Updated: 2025-08-08 02:33:09
  Author: Chamil1983
  
  This configuration file includes settings for:
  - Larger file upload sizes
  - Request validation settings for binary uploads
  - Custom handlers for binary file types
  - Debug settings
-->
<configuration>
  <system.web>
    <compilation debug="true" strict="false" explicit="true" targetFramework="4.7.2" />
    <!-- Increase the maxRequestLength to allow larger file uploads (value in kilobytes) -->
    <httpRuntime targetFramework="4.7.2" maxRequestLength="102400" executionTimeout="3600" requestValidationMode="2.0" />

    <!-- Add this to allow all validation types to pass -->
    <pages validateRequest="false" />

    <!-- Custom errors configuration -->
    <customErrors mode="RemoteOnly" defaultRedirect="~/Error.aspx">
      <error statusCode="404" redirect="~/NotFound.aspx" />
      <error statusCode="500" redirect="~/Error.aspx" />
    </customErrors>

    <!-- Session state configuration -->
    <sessionState mode="InProc" timeout="60" cookieless="UseCookies" />

    <!-- Authentication settings -->
    <authentication mode="None" />
    <authorization>
      <allow users="*" />
    </authorization>

    <!-- Globalization settings -->
    <globalization culture="en-US" uiCulture="en-US" />

    <!-- Disable debugging in production -->
    <!-- <compilation debug="false" /> -->
  </system.web>

  <!-- IIS integrated pipeline mode configuration -->
  <system.webServer>
    <security>
      <requestFiltering>
        <!-- maxAllowedContentLength is in bytes (100MB) -->
        <requestLimits maxAllowedContentLength="104857600" />
      </requestFiltering>
    </security>

    <!-- Disable integrated mode validation -->
    <validation validateIntegratedModeConfiguration="false" />

    <!-- Static file handling configuration -->
    <staticContent>
      <remove fileExtension=".bin" />
      <remove fileExtension=".hex" />
      <remove fileExtension=".elf" />
      <mimeMap fileExtension=".bin" mimeType="application/octet-stream" />
      <mimeMap fileExtension=".hex" mimeType="application/octet-stream" />
      <mimeMap fileExtension=".elf" mimeType="application/octet-stream" />
    </staticContent>

    <!-- Special handlers for binary file types -->
    <handlers>
      <add name="BinaryFileHandler" path="*.bin" verb="*" type="System.Web.DefaultHttpHandler" resourceType="Unspecified" requireAccess="Script" preCondition="integratedMode" />
      <add name="HexFileHandler" path="*.hex" verb="*" type="System.Web.DefaultHttpHandler" resourceType="Unspecified" requireAccess="Script" preCondition="integratedMode" />
      <add name="ElfFileHandler" path="*.elf" verb="*" type="System.Web.DefaultHttpHandler" resourceType="Unspecified" requireAccess="Script" preCondition="integratedMode" />
      <add name="ZipFileHandler" path="*.zip" verb="*" type="System.Web.DefaultHttpHandler" resourceType="Unspecified" requireAccess="Script" preCondition="integratedMode" />
    </handlers>

    <!-- URL Rewrite rules (if needed) -->
    <!--
    <rewrite>
      <rules>
        <rule name="HTTP to HTTPS" stopProcessing="true">
          <match url="(.*)" />
          <conditions>
            <add input="{HTTPS}" pattern="^OFF$" />
          </conditions>
          <action type="Redirect" url="https://{HTTP_HOST}/{R:1}" redirectType="Permanent" />
        </rule>
      </rules>
    </rewrite>
    -->

    <!-- HTTP Compression (optional for production) -->
    <urlCompression doStaticCompression="true" doDynamicCompression="true" />

    <!-- Default Documents -->
    <defaultDocument>
      <files>
        <clear />
        <add value="Default.aspx" />
        <add value="index.html" />
      </files>
    </defaultDocument>

    <!-- HTTP Errors -->
    <httpErrors errorMode="DetailedLocalOnly" existingResponse="Auto" />

    <!-- HTTP Protocols -->
    <httpProtocol>
      <customHeaders>
        <remove name="X-Powered-By" />
        <add name="X-Content-Type-Options" value="nosniff" />
        <add name="X-XSS-Protection" value="1; mode=block" />
        <add name="X-Frame-Options" value="SAMEORIGIN" />
      </customHeaders>
    </httpProtocol>
  </system.webServer>

  <!-- .NET Compilation settings -->
  <system.codedom>
    <compilers>
      <compiler language="c#;cs;csharp" extension=".cs" type="Microsoft.CodeDom.Providers.DotNetCompilerPlatform.CSharpCodeProvider, Microsoft.CodeDom.Providers.DotNetCompilerPlatform, Version=2.0.1.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" warningLevel="4" compilerOptions="/langversion:default /nowarn:1659;1699;1701" />
      <compiler language="vb;vbs;visualbasic;vbscript" extension=".vb" type="Microsoft.CodeDom.Providers.DotNetCompilerPlatform.VBCodeProvider, Microsoft.CodeDom.Providers.DotNetCompilerPlatform, Version=2.0.1.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" warningLevel="4" compilerOptions="/langversion:default /nowarn:41008 /define:_MYTYPE=\&quot;Web\&quot; /optionInfer+" />
    </compilers>
  </system.codedom>

  <!-- Runtime settings -->
  <runtime>
    <assemblyBinding xmlns="urn:schemas-microsoft-com:asm.v1">
      <dependentAssembly>
        <assemblyIdentity name="System.Web.Helpers" publicKeyToken="31bf3856ad364e35" />
        <bindingRedirect oldVersion="1.0.0.0-3.0.0.0" newVersion="3.0.0.0" />
      </dependentAssembly>
      <dependentAssembly>
        <assemblyIdentity name="System.Web.WebPages" publicKeyToken="31bf3856ad364e35" />
        <bindingRedirect oldVersion="1.0.0.0-3.0.0.0" newVersion="3.0.0.0" />
      </dependentAssembly>
    </assemblyBinding>
  </runtime>

  <!-- Application settings -->
  <appSettings>
    <!-- Arduino Web Loader specific settings -->
    <add key="ArduinoCliDefaultPath" value="C:\Users\gen_rms_testroom\Documents\Arduino\Arduino CLI\arduino-cli.exe" />
    <add key="DefaultBoard" value="esp32:esp32:esp32" />
    <add key="DefaultBaud" value="115200" />
    <add key="Version" value="1.5.3" />
    <add key="LastUpdated" value="2025-08-08 02:33:09" />
    <add key="Author" value="Chamil1983" />
    <!-- Framework settings -->
    <add key="ValidationSettings:UnobtrusiveValidationMode" value="None" />
  </appSettings>
</configuration>
